<!-- templates/add_recipe.html -->
{% extends "base.html" %}

{% block content %}
<h2>Добавить рецепт</h2>
<form method="post" enctype="multipart/form-data">
    <p>
        <label>Название: <input name="title" required></label><br>
        <label>Краткое описание:<br> <textarea name="description" maxlength="300" rows="2" style="width: 100%;"></textarea></label>
        <label>Slug (для URL): <input name="slug" required placeholder="espresso-v3"></label><br>
        <label>Обложка (не обязательно):  <input type="file" name="recipe_image" accept="image/*">
</label>
    </p>

    <h3>Ингредиенты</h3>
    <div id="ingredients">
        <div><input name="ingredient-name" placeholder="Название" required>
             <input name="ingredient-amount" type="number" step="0.1" placeholder="Кол-во" required>
             <input name="ingredient-unit" placeholder="Ед. (г/мл)" value="г">
             <input name="ingredient-phase" placeholder="Фаза" value="Основа"></div>
    </div>
    <button type="button" onclick="addItem('ingredients', 'ingredient')">+ Ингредиент</button>

    <h3>Шаги</h3>
    <div id="steps">
        <div>
            <textarea name="step-instruction" placeholder="Действие с точными параметрами" required></textarea>
            <input name="step-duration" type="number" placeholder="Время (мин)">
            <input name="step-temp" type="number" placeholder="Темп. (°C)">
            <input name="step-image" type="file" accept="image/*">
        </div>
    </div>
    <button type="button" onclick="addItem('steps', 'step')">+ Шаг</button>

    <br><br>
    <button>Создать рецепт</button>
</form>

<script>
function addItem(containerId, prefix) {
    const container = document.getElementById(containerId);
    const div = document.createElement('div');
    if (prefix === 'ingredient') {
        div.innerHTML = `
            <input name="ingredient-name" placeholder="Название" required>
            <input name="ingredient-amount" type="number" step="0.1" placeholder="Кол-во" required>
            <input name="ingredient-unit" placeholder="Ед. (г/мл)" value="г">
            <input name="ingredient-phase" placeholder="Фаза" value="Основа">
            <button type="button" onclick="this.parentElement.remove()">×</button>
        `;
    } else {
        div.innerHTML = `
            <textarea name="step-instruction" placeholder="Действие..." required></textarea>
            <input name="step-duration" type="number" placeholder="Время (мин)">
            <input name="step-temp" type="number" placeholder="Темп. (°C)">
            <input name="step-image" type="file" accept="image/*">
            <button type="button" onclick="this.parentElement.remove()">×</button>
        `;
    }
    container.appendChild(div);
}
</script>

<style>
#ingredients div, #steps div {
    border: 1px solid #ddd; padding: 0.6rem; margin: 0.4rem 0; border-radius: 3px;
}
input, textarea { margin: 0.2rem 0.4rem 0.2rem 0; padding: 0.3rem; }
button { margin: 0.2rem; }
</style>
{% endblock %}